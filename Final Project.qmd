---
title: "Data Management Final Project"
author: "Tom Flachaire & Raphael Paillard"
format: html
---

## Project description

### Github link

Please find the github link [here](https://github.com/tomflachaire/Infant_mortality/tree/main).

### Sources links

https://www.insee.fr/fr/statistiques/7624538?sommaire=7624746&utm_

With this link, we downloaded :

- P3D – Indicateurs généraux de la population par département et région - Séries depuis 1990;
- P1D – Évolution générale de la situation démographique par département et région - Séries depuis 1990
- P2D – Mortalité infantile par département et région - Séries depuis 1990.

On the Data DREES website: https://data.drees.solidarites-sante.gouv.fr/explore/dataset/la-demographie-des-professionnels-de-sante-depuis-2012/information/

We downloaded data on midwife demographics from 2012 to 2025.

Then, we moved them to csv files only keeping the year 2019, the last year available before COVID, which might affect the result.

### Description of the sources and important variables

The data comes from French sources, the INSEE (National Institute of Statistics and Economic Studies) and the DREES (Directorate for Research, Studies, Evaluation, and Statistics).

Infant Mortality provides department-level statistics on the number of deaths of children under one year old. These data, produced by INSEE and Santé publique France, help analyze regional disparities in infant health.

Population Indicators include information on fertility, average maternal age at childbirth, and the proportion of births outside marriage, broken down by department and year.

Demographic Situation contains data on marriages, population counts, nuptiality rates, birth rates, and natural population growth by department and year. 

Midwives RPPS 2012–2025 tracks the number and density of registered midwives across French departments.

### Basic information about each data file

```{r}
library(readr)
library(dplyr)
library(ggplot2)
library(knitr)
library(here)
```

```{r}
# Function to extract basic information
get_data_info <- function(file_path) {
  data <- read.csv2(file_path)
  list(
    Fichier = basename(file_path),
    Lignes = nrow(data),
    Colonnes = ncol(data),
    Noms_des_colonnes = paste(colnames(data), collapse = ", ")  # Convert to string
  )
}

data_files <- list.files(path = "data/", pattern = "\\.csv$", full.names = TRUE)
data_info <- lapply(data_files, get_data_info) # Apply the function to each file
data_info_df <- do.call(rbind.data.frame, data_info) # Convert the list to a data.frame
rownames(data_info_df) <- NULL

# Display the result
print(data_info_df)
```

### Research Question

Why does infant mortality vary so much across French departments?

This project examines the factors that can explain variations in infant mortality rates across French departments. We will look at the role of demographic characteristics and access to maternal healthcare. While France performs relatively well in terms of infant health at the national level, there are huge territorial disparities. Some departments consistently have higher infant mortality rates than others, raising questions about the causes of these differences.

Demographic indicators such as fertility rates, maternal age at childbirth, and the proportion of births outside marriage—offer explains the social and economic contexts in which children are born. These factors may influence early childhood health risks.

A key aspect of this research is the distribution of midwives across departments. Midwives play a important role in premature deaths. 

The project aims to identify the factors most closely associated with variations in infant mortality. The objective is not only to describe regional disparities but also to understand their causes. 

We only kept data from 2019, the most recent year available before covid that could influence our results. 

### Main target variable

We created a graph to visualize our main target variable, which is infant mortality. We kept the five departments with the highest and lowest mortality rates for this graph, to show that there are huge disparities between departments in 2019.

```{r}
infant_mortality <- read_csv2(
  here("data/mortalite_infantile.csv"),
  skip = 4
) %>%
 mutate(
# Convert all numeric columns to numeric type
    `Nés vivants (a)` = parse_number(`Nés vivants (a)`, locale = locale(decimal_mark = ",", grouping_mark = " ")),
    `Décédés de moins d'un an (b)` = parse_number(`Décédés de moins d'un an (b)`, locale = locale(decimal_mark = ",", grouping_mark = " ")),
    `Décédés de moins de 7 jours (b)` = parse_number(`Décédés de moins de 7 jours (b)`, locale = locale(decimal_mark = ",", grouping_mark = " ")),
    `Décédés de moins de 28 jours (b)` = parse_number(`Décédés de moins de 28 jours (b)`, locale = locale(decimal_mark = ",", grouping_mark = " ")),
    `Infantile (c)` = parse_number(`Infantile (c)`, locale = locale(decimal_mark = ",", grouping_mark = " ")),
    `Néonatale (d)` = parse_number(`Néonatale (d)`, locale = locale(decimal_mark = ",", grouping_mark = " "))
  ) %>%
  filter(!is.na(`Décédés de moins d'un an (b)`))  # Supprime les lignes avec NA

# we exclude regional total
infant_mortality <- infant_mortality %>%
  filter(
    !grepl("France|métropole|Sous-total|Outre Mer", `Départements et régions`, ignore.case = TRUE),
    !`Départements et régions` %in% c("Ile-de-France", "Centre-Val de Loire", 
                                       "Bourgogne-Franche-Comté", "Normandie",
                                       "Hauts-de-France", "Grand Est", 
                                       "Pays de la Loire", "Bretagne",
                                       "Nouvelle-Aquitaine", "Occitanie",
                                       "Auvergne-Rhône-Alpes", "Provence-Alpes-Côte d'Azur",
                                       "Corse")
  )

```

```{r}
# Top 5 and Bottom 5 departments
top5 <- infant_mortality %>%
  arrange(desc(`Décédés de moins d'un an (b)`)) %>%
  slice(1:5)

bottom5 <- infant_mortality %>%
  arrange(`Décédés de moins d'un an (b)`) %>%
  slice(1:5)

top_bottom <- bind_rows(
  top5 %>% mutate(categorie = "Plus élevé"),
  bottom5 %>% mutate(categorie = "Plus faible")
)

# Graphical representation
ggplot(top_bottom, 
       aes(x = reorder(`Départements et régions`, `Décédés de moins d'un an (b)`), 
           y = `Décédés de moins d'un an (b)`,
           fill = categorie)) +
  geom_col() +
  geom_text(aes(label = `Décédés de moins d'un an (b)`), 
            hjust = -0.2, size = 3.5) +  # Ajoute les valeurs
  scale_fill_manual(values = c("Plus élevé" = "coral", "Plus faible" = "steelblue")) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +  # Plus d'espace à droite
  coord_flip() +
  labs(title = "Décès de moins d'un an par département (2019)",
       subtitle = "5 départements avec le plus et le moins de décès",
       y = "Nombre de décès", 
       x = NULL,
       fill = NULL) +
  theme_minimal() +
  theme(legend.position = "top")
```

### Data Preparation and Cleaning

We imported the infant mortality dataset from a CSV file using the `read_csv2()` function. 
The file contained data in the first four rows (title, year, and empty lines), 
which we skipped using the `skip = 4` parameter to start reading from the actual column headers. We filtered out rows containing NA values in the variables. We excluded regional totals and national aggregates to ensured we only kept individual department-level observations. 

All columns were initially imported as character type due to formatting issues so we converted the mortality count variable to numeric using `parse_number`.

Now let's clean the other databases.

For indicateurs_generaux database :

```{r}
indicateurs_generaux <- read_csv2(
  here("data/indicateurs_population.csv"),
  skip = 3
) 
# Keep only departments (exclude regional totals)
indicateurs_generaux <- indicateurs_generaux %>%
  filter(
    !grepl("France|métropole|Sous-total|Outre Mer", `Départements et régions`, ignore.case = TRUE),
    !`Départements et régions` %in% c("Ile-de-France", "Centre-Val de Loire", 
                                       "Bourgogne-Franche-Comté", "Normandie",
                                       "Hauts-de-France", "Grand Est", 
                                       "Pays de la Loire", "Bretagne",
                                       "Nouvelle-Aquitaine", "Occitanie",
                                       "Auvergne-Rhône-Alpes", "Provence-Alpes-Côte d'Azur",
                                       "Corse", "Départements et régions d'Outre Mer")
  )
```

For situation_demographique database :

```{r}
situation_demo <- read_csv2(
  here("data/situation_demographique.csv"),
  skip = 4
) 
# Keep only departments (exclude regional totals)
situation_demo <- situation_demo %>%
  filter(
    !grepl("France|métropole|Sous-total|Outre Mer|Autres", `Départements et régions`, ignore.case = TRUE),
    !`Départements et régions` %in% c("Ile-de-France", "Centre-Val de Loire", 
                                       "Bourgogne-Franche-Comté", "Normandie",
                                       "Hauts-de-France", "Grand Est", 
                                       "Pays de la Loire", "Bretagne",
                                       "Nouvelle-Aquitaine", "Occitanie",
                                       "Auvergne-Rhône-Alpes", "Provence-Alpes-Côte d'Azur",
                                       "Corse", "Départements et régions d'Outre Mer")
  )
```

